from typing import List

from exercise.myUtils import timer


class Solution:
    @timer
    def eventualSafeNodes(self, graph: List[List[int]]) -> List[int]:
        temp = [0] * len(graph)

        def track(n):
            if not graph[n]:
                return True
            elif temp[n] == -1:
                return False
            elif temp[n] == 2:
                return True

            temp[n] = 1

            loopflag = False
            for m in graph[n]:
                if temp[m] == 1 or not track(m):
                    temp[m] = -1
                    loopflag = True
                    break
                temp[m] = 2

            return not loopflag

        for i in range(len(graph)):
            if temp[i] == 0:
                if track(i):
                    temp[i] = 2
                else:
                    temp[i] = -1
        return [i for i in range(len(graph)) if temp[i] == 2]


s = Solution()
assert s.eventualSafeNodes(graph=[[1, 2], [2, 3], [5], [0], [5], [], []]) == [2, 4, 5, 6]
assert s.eventualSafeNodes(graph=[[1, 2], [2, 3], [5], [0], [5], [], []]) == [2, 4, 5, 6]
assert s.eventualSafeNodes(graph=[[3], [2, 3], [5], [0], [5], [], []]) == [2, 4, 5, 6]
assert s.eventualSafeNodes(
    [[104, 130, 164], [38, 66, 139], [86, 106, 116, 155], [12, 42, 123], [153], [40, 47, 66, 94, 151],
     [18, 29, 87, 125, 127, 193], [], [61, 193], [89, 115, 136, 177], [71, 129], [111, 120],
     [108, 113, 136, 147, 188, 192], [44, 91, 98, 113, 186], [133], [140, 152], [116, 197], [80, 110, 193],
     [21, 54, 94, 120, 167, 173], [81, 94, 112, 114], [], [101], [66, 122, 164], [139, 153, 172], [34, 84, 181], [132],
     [], [126, 136, 196], [31, 34, 78, 97, 185], [55, 68, 98, 192], [44, 54, 104, 108, 140, 193], [99, 153],
     [38, 88, 101, 111, 127, 141], [24, 42, 76, 177, 180, 182, 199], [88, 138, 197], [38, 185], [46, 95, 131, 191], [],
     [60, 162, 187, 198], [134], [54, 60, 63, 70, 146, 159], [49, 59, 177], [174, 185], [28, 117, 139, 181, 192],
     [41, 66, 79, 81, 107, 195], [56, 121, 144, 149, 155, 159], [119, 187], [53, 101, 129, 148, 170, 199],
     [60, 66, 145, 159, 166, 195], [15, 168], [136], [19], [53, 58, 79, 120, 181, 193], [111, 138],
     [72, 137, 142, 180, 184], [62, 76, 98, 104, 177], [88, 165, 182, 196], [118, 141], [76, 81, 164], [63, 180, 199],
     [121, 142, 182], [65, 91, 110], [96, 101, 102], [69, 77, 129, 147, 166, 180], [], [74, 75, 88, 121],
     [68, 86, 105, 122, 148, 181], [107], [82, 85, 93], [83, 92, 134, 153, 163, 176], [81, 170, 176],
     [97, 131, 141, 144], [81, 169, 179], [], [184, 194], [80, 184, 193], [174, 193, 197], [32],
     [106, 119, 120, 154, 172, 198], [162, 173], [98, 136, 150, 152, 185, 193], [95, 120, 134, 145, 161], [87, 95, 160],
     [142, 167], [166, 169, 174], [92, 118, 166, 185, 186], [90, 113, 123, 135, 149, 192], [], [89, 105, 106, 113, 194],
     [184], [116, 122, 124, 185, 186], [100, 134, 178], [130, 163, 198], [17], [105, 161, 179, 189, 191, 196],
     [57, 116, 194], [165, 195], [54, 105, 167, 195], [122, 130, 163, 170, 193, 196], [], [120, 143, 145, 151], [198],
     [120, 149, 161, 179, 186, 191], [122, 179, 194], [140, 169, 193], [150], [129, 196], [], [86, 129, 173, 174],
     [152, 153, 160, 177], [], [124, 125, 127, 135, 149, 173], [140, 156, 187, 191], [143, 179], [159],
     [120, 125, 139, 165, 187], [124], [166, 198], [126, 131, 143, 146, 182], [134, 152, 154, 159],
     [127, 136, 163, 179, 182], [122, 134, 136, 172, 198], [140, 147, 175, 180, 188], [131, 146, 155, 174],
     [133, 143, 173, 178, 191], [146, 155, 167, 179, 183], [146, 152, 181, 188, 195, 196], [],
     [136, 140, 144, 145, 179, 194], [193], [], [141, 151, 158], [186], [], [147, 165], [137, 168, 170, 171],
     [148, 174, 181, 196, 197], [140, 142, 144, 155, 158, 194], [], [148, 160], [143, 195], [171, 178, 188, 197],
     [147, 150, 168, 169, 177, 189], [156, 164], [162, 165, 167, 184, 188, 194], [161], [], [148, 189], [149, 151, 155],
     [122, 167], [], [152, 169, 175, 188, 192], [180, 187, 188], [], [177], [156, 168, 181, 193],
     [165, 167, 175, 178, 188, 191], [], [160, 167, 177, 179, 187, 198], [165, 177, 186, 187], [168, 180, 193], [155],
     [167, 176, 185, 196, 199], [164, 173, 182], [174, 179, 182, 191], [191, 197], [172, 178, 188, 189],
     [137, 185, 199], [179, 187, 191], [176, 182, 185], [144, 174, 175, 182, 184, 193, 195], [173, 180, 187, 191, 197],
     [], [177, 187], [79, 182, 186, 189, 196], [176, 182, 186, 190], [177, 185], [199], [186, 193],
     [182, 183, 189, 194, 198], [], [189, 192, 193, 195, 197, 198], [], [188, 189, 191, 192],
     [185, 187, 188, 190, 192, 199], [191, 194, 199], [187, 191, 194, 195, 196, 197], [188, 193, 195, 197],
     [134, 189, 191, 193], [190, 193, 194, 197], [196], [192, 193, 196, 198, 199], [], [194, 195, 196, 197, 198, 199],
     [196, 197, 199], [196, 197, 198, 199], [198, 199], [], [199], []])

assert s.eventualSafeNodes(
    [[269, 274, 305, 330, 468], [123, 192, 290, 489], [302, 414], [92, 401], [83, 476], [59, 202, 434], [75, 204],
     [190, 283, 292], [59, 473], [414], [66, 197], [31, 206, 238, 301, 457], [184, 333, 423, 436],
     [15, 371, 423, 436, 446, 492], [174, 422], [84, 296], [63, 194, 258, 431, 437], [43, 263, 286, 449, 461], [157],
     [31, 32, 99, 403, 421, 448], [112], [68, 324, 357, 369], [41, 51, 94, 206, 287, 374], [229, 261, 378], [46, 386],
     [268, 342, 389], [60, 133, 352, 356], [4, 148], [153, 205, 221, 235, 426], [198, 232], [190, 443], [38, 101, 130],
     [], [40, 73, 395], [182, 354, 357, 361, 432], [169, 173, 214, 256, 303, 483], [235, 465], [257, 271, 280, 383],
     [157, 170, 276], [311], [122, 142, 330, 421, 491], [425, 427], [79, 238, 310], [150, 202, 340, 386, 440, 464], [],
     [52, 63, 135, 238, 298, 499], [], [62, 288, 336, 375, 413, 498], [189, 299], [270, 407, 420, 426, 445, 476], [],
     [], [], [270], [496], [118, 144], [238, 250, 262, 368, 448], [180, 340, 429, 454, 483], [351, 377], [415, 488],
     [73, 223, 281, 293, 476], [], [], [219, 351, 429], [148, 160], [72, 109, 234, 288], [213, 326], [99, 243], [], [],
     [], [192, 239, 247, 486], [], [443, 484], [130, 189, 276, 369, 370], [162, 353], [], [265, 336, 360],
     [146, 255, 313, 368], [187, 195, 234, 318, 407, 411], [127, 133, 227, 339, 372, 407], [159, 203, 213, 317],
     [172, 270, 284], [288, 458, 474, 481], [171, 447], [190, 212, 259, 285, 293, 315], [313, 440],
     [121, 127, 161, 199, 419], [151, 265, 332, 379, 404, 411], [495], [143, 144, 179, 424],
     [158, 184, 371, 379, 445, 498], [], [279, 369, 392, 425], [118, 127, 175, 235, 340], [],
     [104, 114, 208, 238, 333, 372], [10, 221, 279, 381, 480, 499], [405], [146, 300, 379, 417], [], [136, 146, 391],
     [113, 239, 368, 445], [129, 374, 437, 461, 492], [135, 159, 172, 318, 356], [], [230, 239], [361], [187, 276, 338],
     [], [145, 299, 379, 457, 470], [303, 497], [267, 315, 399], [204, 209, 235, 245, 359, 392], [270, 350, 451, 485],
     [], [], [174, 331, 370, 382, 419], [175, 410, 423, 461], [165, 246, 261, 476, 495], [318, 353, 469, 484, 496],
     [220, 406], [454], [206, 209, 239], [184, 231, 232], [], [160, 308, 344, 412], [249, 266], [41, 192], [241],
     [139, 157, 160, 248, 277, 324], [167, 278], [167, 249, 444, 460], [], [158, 379, 410, 462], [202, 372], [282, 380],
     [168, 466], [259, 268, 280, 309, 341, 467], [343], [178, 415, 419, 485], [106, 167, 172, 216, 302, 463], [], [310],
     [305, 331, 337, 400, 479], [246, 402, 436, 487], [206, 255, 302, 395], [205, 366], [], [214, 281, 288, 360, 385],
     [205, 254, 345, 428], [329, 337, 416], [200, 304, 366, 371, 428, 491], [342], [205, 301, 343, 463], [390],
     [180, 234], [197, 307, 319, 341, 348, 468], [], [], [430, 455], [300, 402, 466], [218, 223, 240, 298, 320, 482],
     [297, 414], [270, 347, 368, 399, 409], [277, 369, 458], [382], [252], [177, 419], [], [414], [479],
     [175, 182, 222, 225, 269], [196, 238, 267, 481], [279, 387, 404, 425, 430, 487], [178, 182, 324], [254, 275, 371],
     [181, 230, 365, 390], [232, 246, 311, 403, 458], [289, 302, 420, 422, 444, 491], [323, 371, 411, 426, 448],
     [232, 395, 426], [186, 277, 290, 362, 405, 484], [333, 338, 353, 378], [424], [260, 323, 330, 336, 358],
     [242, 260, 412, 414, 493], [435, 452, 497], [234, 305, 341, 372, 393], [], [232, 328, 338, 391, 403],
     [272, 481, 497], [233], [236, 254, 362, 469], [284, 346], [241, 275, 478], [], [246, 340],
     [237, 259, 402, 457, 499], [244, 295, 478], [298, 331, 373, 474], [257, 310, 343, 366], [213, 379, 406],
     [235, 393], [], [348, 428, 479, 480], [354], [274, 424, 439, 467, 492], [281, 289, 386, 444],
     [251, 256, 372, 442, 459, 468], [92, 315, 405, 436, 441, 496], [113, 225, 262, 326, 370, 432, 493],
     [217, 234, 460], [302, 303, 455, 487], [366], [245, 286, 304, 368, 415, 496], [239, 272, 415, 444], [261, 487],
     [273, 422], [240, 249, 412, 439, 454], [255, 317], [241, 269, 361, 383, 470], [228, 307, 331, 345, 355], [329], [],
     [292, 331, 393, 427, 476], [229, 382], [302, 354], [334, 451], [365, 367, 482], [290, 295, 332, 397, 416, 440], [],
     [314, 457], [], [382, 432, 465, 468], [83, 424], [261], [266, 352, 404, 428, 448], [342, 379, 447, 448],
     [361, 362, 462], [343, 494], [], [376], [258, 287, 333, 449, 453], [], [297, 365, 398, 477],
     [257, 276, 405, 406, 468, 478], [260, 288, 293, 365, 468], [285, 316, 329, 384, 398], [], [201, 296, 424, 488],
     [398, 412, 433], [264, 319, 432, 443, 474, 480], [325, 464, 478], [273, 290, 327, 446, 493, 495],
     [266, 304, 355, 401, 460], [273, 328, 352, 377, 427], [328], [270, 353, 385], [315, 395, 437, 469], [275],
     [263, 341, 372, 386, 390, 406], [87, 322, 397, 413], [299, 329, 378, 406, 428, 491],
     [278, 317, 350, 405, 435, 487], [347, 422], [377, 452, 470], [306, 350, 359, 362, 432, 468], [335, 411, 436], [],
     [351, 468], [332, 333, 481], [285, 422, 434, 477], [348], [284, 353, 376, 468, 486], [388, 423],
     [50, 320, 350, 477, 478], [347, 423], [294], [346, 389, 393, 396, 400], [313, 480, 485], [370, 377, 430],
     [413, 419, 438, 478, 489], [337, 353, 383, 406, 413, 491], [312, 396, 443, 459, 489],
     [330, 331, 417, 422, 439, 447], [308], [311, 320, 325, 387, 407, 428], [289, 313, 331], [363, 398, 431], [],
     [197, 314, 439, 454, 465], [345, 355, 469, 480], [305], [311, 313, 357, 435], [], [336, 355, 374, 393], [],
     [303, 367, 385, 489], [366, 368], [486], [], [305, 365, 489], [], [352, 430, 447, 489], [388, 455],
     [407, 417, 439, 453, 478], [313, 339, 400, 408], [423], [331, 360, 418], [337, 364, 425, 462, 468, 480],
     [377, 378, 429, 431, 449, 459], [], [], [351, 433, 451, 455], [4, 330, 334, 470, 475, 488, 489], [324, 417],
     [338, 348, 402, 404, 418], [373], [349, 372, 435, 468, 472, 488], [329, 331, 496], [418], [97, 441, 468, 490], [],
     [425], [327, 331, 401, 403, 438], [385, 431, 459, 486], [332, 350, 356], [331, 497], [361, 364, 399, 413, 429],
     [469], [], [], [447], [344, 365, 379, 380, 381, 464], [356, 365, 395, 408, 417, 426], [], [434],
     [384, 388, 413, 461, 474, 480], [418], [], [464, 491], [354, 395, 484, 488], [], [], [465], [455, 464], [460],
     [375, 415, 449], [357, 361, 407, 418, 426, 441], [409], [355, 382, 391, 466], [106, 406, 437, 443, 462],
     [369, 440, 447], [366, 386, 404, 436], [392, 449, 462, 468, 488, 489], [376, 379, 383, 400, 415],
     [386, 388, 392, 462, 478], [], [270, 364, 468], [378, 386, 426, 427, 494], [375, 451], [],
     [368, 377, 447, 472, 486, 498], [385, 473], [], [484, 492], [422, 425, 463, 488, 498], [452], [377], [380],
     [395, 421, 460, 470], [389, 391, 429, 448], [419, 441], [387, 395, 401, 441, 442, 496], [456, 485, 492],
     [382, 420], [422, 444, 463], [411], [403, 404, 412, 413, 490, 499], [455, 469, 496], [410, 423, 450, 491, 498],
     [420], [392, 410, 411, 465, 491], [439], [421, 474, 492], [400, 424, 447, 472, 482], [442], [428, 479, 487],
     [414, 472], [402, 481], [], [413, 445, 446, 463], [399, 409, 438, 467], [407, 427, 454, 480, 484],
     [398, 404, 406, 436], [481], [430, 438, 463, 470, 474, 482], [451, 456, 475, 479, 499], [434], [455],
     [405, 448, 476, 485], [], [429, 432, 458, 477, 491, 496], [442, 469, 474, 478, 490, 495], [412, 415, 464, 481],
     [422, 423, 441, 475, 489], [437, 439, 443, 451], [496], [424, 455, 469], [421, 471, 474, 482],
     [414, 452, 460, 470, 475, 481], [426, 428, 464, 466, 473, 494], [423, 432, 494], [425], [479, 499],
     [418, 426, 430, 477], [444, 474, 489, 491], [438, 488], [453], [450, 453], [466, 468, 471, 475, 489, 494],
     [431, 450, 465, 482], [446, 447], [443, 470], [], [446], [438, 449, 468, 469], [437, 451, 467, 481, 493],
     [439, 474, 487], [436, 439, 465, 475, 478, 488], [], [436, 447, 461, 462, 466, 480], [], [460, 469, 488],
     [440, 445, 446], [447, 472, 483], [447, 453, 476], [443, 456, 490], [453], [448, 461, 470, 490, 492, 498],
     [444, 452, 483], [467], [453, 469, 483, 485, 486], [448, 450, 457, 465, 467, 498], [], [453, 461, 465, 498],
     [458, 459, 467, 489, 492], [], [], [465, 487, 497, 499], [], [286, 467, 481, 492, 493, 495, 498], [475],
     [455, 458, 466, 479, 488, 491], [465, 471, 493, 496], [459, 479, 481], [470, 483, 494, 497],
     [469, 485, 488, 489, 491, 493], [469], [468, 477, 484, 495], [463, 474, 480, 498], [465, 474, 480, 483, 491, 497],
     [], [469, 496], [472, 479, 495, 498, 499], [467, 484, 485, 490, 492, 497], [469, 484], [476], [474],
     [477, 483, 492], [476, 480, 491], [490], [475, 476, 479, 481, 484, 496], [475, 480, 481, 488, 491, 494],
     [476, 477, 481, 483, 487, 499], [480, 483, 496], [480, 485, 486, 487, 491, 496], [492], [480, 483, 487, 497],
     [482, 487], [], [], [486, 491], [485, 490, 491, 492], [], [], [489], [493], [490, 494], [495, 496, 498], [497],
     [493, 494, 495, 496, 498, 499], [494, 495, 496, 497, 498, 499], [496, 497, 498], [496, 497, 498, 499], [],
     [498, 499], [499], []])
